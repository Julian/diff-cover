<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv='Content-Type' content='text/html; charset=utf-8'>
<style type='text/css' media='all'>
@import url('diff_cover.css');
</style>
<title>Diff Coverage</title>
</head>
<body>
<section id='header'>
  <h1>Diff Coverage</h1>
  <p>Coverage Report: {{ report_name }}</p>
  <p>Diff: {{ diff_name }}</p>

  <ul>
    <li><b>Total</b>: {{ total_num_lines }} line(s)</li>
    <li><b>Missing</b>: {{ total_num_missing }} line(s)</li>
    <li><b>Coverage</b>: {{ total_percent_covered }}%</li>
  </ul>
</section>

<section id='debug'>
  <h2>DEBUG</h2>
  <p><code>src_stats</code> has {{ src_stats.keys()|count }} items:</p>
  <ul>
    {% for src_path, stats in src_stats.iteritems() %}
    <li>
      <p>{{ src_path|e }}</p>
      <table>
	<tr><th>Key</th><th>Value</th></tr>
	{% for key, val in stats.iteritems() %}
	<tr><td><code>{{ key|e }}</code></td><td><code>{{ val|e }}</code></td></tr>
	{% endfor %}
      </table>
      <br/><br/>
    </li>
    {% endfor %}
  </ul>

  <p>Now we have a <code>for</code> loop with the condition (search for files with missing lines):</p>
  <ul>
    {% for src_path, stats in src_stats.iteritems() if stats.num_missing > 0 %}
    <li>
      <p>{{ src_path|e }}</p>
      <pre>{{ augmented_stats[src_path] }}</pre>
    </li>
    {% endfor %}
  </ul>


  <p>Now we have a <code>for</code> loop in <code>augmented_stats</code></p>
  <ul>
    {% for src_path, hunks in augmented_stats.iteritems() %}
    <li>
      <p>{{ src_path|e }}</p>
      {% for hunk in hunks %}
      <pre>{{ hunk }}</pre>
      {% endfor %}
    </li>
    {% endfor %}
  </ul>

</section>



{% if src_stats %}
<section id='code'>
  {% for src_path, stats in src_stats.iteritems() if stats.num_missing > 0 %}
  <div>
    <div class='file-header'>
      <h2>{{ src_path|e }}</h2>
      <p>{{ stats.percent_covered|round(1) }}% diff coverage, {{ stats.num_missing }} missing line(s)</p>
    </div>
    <table><tr>
      <td class='linenos' valign='top'>
	{% for hunk in augmented_stats[src_path] %}
	{% for line in hunk %}
	<p class='{# className matches /(violation|context)( indiff)?/
	   Also, add a '+' before the line number if in the diff
	   #}{{ "violation" if line.is_violation else "context" }}{#
	   #}{{ " indiff" if line.in_diff }}'{#
	  #}>{#
	  #}{% if line.in_diff %}<span>+</span>{% endif %}{#
	  #}{{ line.num }}</p>
	{% endfor %}
	{% if not loop.last %}

	<p class='hunk-separator'>&vellip;</p>

	{% endif %}
	{% endfor %}
      </td>

      <td class='thecode' valign='top'>
	{% for hunk in augmented_stats[src_path] %}
	{% for line in hunk %}
	<p class='{# Same class name as above
	   Highlight the python source, and substitute in â–® for empty strings
	   #}{{ "violation" if line.is_violation else "context" }}{#
	   #}{{ " indiff" if line.in_diff }}'{#
	  #}>{{ line.code|py_highlight|default("â–®", true) }}</p>
	{% endfor %}
	{% if not loop.last %}

	<p class='hunk-separator'>&vellip;</p>

	{% endif %}
	{% endfor %}
      </td>
    </tr></table>
  </div>
  {% endfor %}
</section>

<section id='perfect-code'>
  <h2>Covered Code</h2>
  <p>The following files have 100% diff coverage. ðŸ˜ƒ{# smiley face #}</p>
  <ul>
    {% for src_path, stats in src_stats.iteritems() if stats.num_missing == 0 %}
    <li>{{ src_path|e }}</li>
    {% endfor %}
  </ul>
</section>
{% endif %}
</body>
</html>
