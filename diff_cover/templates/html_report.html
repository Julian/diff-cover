<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv='Content-Type' content='text/html; charset=utf-8'>
<style type='text/css' media='all'>
@import url('diff_cover.css');
</style>
<title>Diff Coverage</title>
</head>
<body>
<section id='header'>
  <h1>Diff Coverage</h1>
  <p>Coverage Report: {{ report_name }}</p>
  <p>Diff: {{ diff_name }}</p>

  <ul>
    <li><b>Total</b>: {{ total_num_lines }} line(s)</li>
    <li><b>Missing</b>: {{ total_num_missing }} line(s)</li>
    <li><b>Coverage</b>: {{ total_percent_covered }}%</li>
  </ul>
</section>

{# example (delete later!) #}
<section id='code'>
  <div>
    <div class='file-header'>
      <h2>common/lib/xmodule/xmodule/capa_module.py</h2>
      <p>72% diff coverage, 4 missing line(s)</p>
    </div>
    <table><tr>
      <td class='linenos' valign='top'>
	<p class='context'>73</p>
	<p class='context'>74</p>
	<p class='violation indiff'><span>+</span>75</p>
	<p class='context'>76</p>
	<p class='context'>77</p>

	<p class='hunk-separator'>&vellip;</p>

	<p class='context'>304</p>
	<p class='context'>305</p>
	<p class='violation indiff'><span>+</span>306</p>
	<p class='context'>307</p>
	<p class='context'>308</p>

	<p class='hunk-separator'>&vellip;</p>

	<p class='context'>425</p>
	<p class='context'>426</p>
	<p class='violation indiff'><span>+</span>427</p>
	<p class='violation indiff'><span>+</span>428</p>
	<p class='context'>429</p>
	<p class='context'>430</p>
      </td>

      <td class='thecode' valign='top'>
	<p class='context'>        """</p>
	<p class='context'>        if isinstance(obj, complex):</p>
	<p class='violation indiff'>            return u"{real:.7g}{imag:+.7g}*j".format(real=obj.real, imag=obj.imag)</p>
	<p class='context'>        return json.JSONEncoder.default(self, obj)</p>
	<p class='context'>â–®</p>

	<p class='hunk-separator'>&vellip;</p>

	<p class='context'>            try:</p>
	<p class='context'>                return Progress(score, total)</p>
	<p class='violation indiff'>            except (TypeError, ValueError):</p>
	<p class='context'>                log.exception("Got bad progress")</p>
	<p class='context'>                return None</p>

	<p class='hunk-separator'>&vellip;</p>

	<p class='context'>                    url=cgi.escape(self.location.url()))</p>
	<p class='context'>            )</p>
	<p class='violation indiff'>            msg += u'&lt;p&gt;Error:&lt;/p&gt;&lt;p&gt;&lt;pre&gt;{msg}&lt;/pre&gt;&lt;/p&gt;'.format(msg=cgi.escape(err.message))</p>
	<p class='violation indiff'>            msg += u'&lt;p&gt;&lt;pre&gt;{tb}&lt;/pre&gt;&lt;/p&gt;'.format(tb=cgi.escape(traceback.format_exc()))</p>
	<p class='context'>            html = msg</p>
	<p class='context'>â–®</p>
      </td>
    </tr></table>
  </div>
</section>

<section id='perfect-code'>
  <h2>Covered Code</h2>
  <p>The following files have 100% diff coverage. ðŸ˜ƒ{# smiley face #}</p>
  <ul>
    <li>common/lib/xmodule/xmodule/tests/test_capa_module.py</li>
  </ul>
</section>

{# THE ACTUAL THING (get rid of the fake above)
{% if src_stats %}
<section id='code'>
  {% for src_path, stats in src_stats.iteritems() if stats.num_missing > 0 %}
  <div>
    <div class='file-header'>
      <h2>{{ src_path|e }}</h2>
      <p>{{ stats.percent_covered|round(1) }}% diff coverage, {{ stats.num_missing }} missing line(s)</p>
    </div>
    <table><tr>
      <td class='linenos' valign='top'>
	{% for hunk in stats.hunks %}
	{% for line in hunk.getIter() %}
	<p class='{# className matches /(violation|context)( indiff)?/
	   Also, add a '+' before the line number if in the diff
	   #}{{ "violation" if line.is_violation else "context" }}{#
	   #}{{" indiff" if line.in_diff }}'{#
	  #}>{#
	  #}{% if line.in_diff %}<span>+</span>{% endif %}{#
	  #}{{ line.linenum }}</p>
	{% endfor %}
	{% if not loop.last %}

	<p class='hunk-separator'>&vellip;</p>

	{% endif %}
	{% endfor %}
      </td>

      <td class='thecode' valign='top'>
	{% for hunk in stats.hunks %}
	{% for line in hunk.getIter() %}
	<p class='{# Same class name as above
	   Highlight the python source, and substitute in â–® for empty strings
	   #}{{ "violation" if line.is_violation else "context" }}{#
	   #}{{" indiff" if line.in_diff }}'{# (hidden newline)
	  #}>{{ line.source|py_highlight|default("â–®", true) }}</p>
	{% endfor %}
	{% if not loop.last %}

	<p class='hunk-separator'>&vellip;</p>

	{% endif %}
	{% endfor %}
      </td>
    </tr></table>
  </div>
  {% endfor %}
</section>

<section id='perfect-code'>
  <h2>Covered Code</h2>
  <p>The following files have 100% diff coverage. ðŸ˜ƒ{# smiley face #}</p>
  <ul>
    {% for src_path, stats in src_stats.iteritems() if stats.num_missing == 0 %}
    <li>{{ src_path|e }}</li>
    {% endfor %}
  </ul>
</section>
{% endif %}
#}
</body>
</html>
